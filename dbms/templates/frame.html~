
<!DOCTYPE html>
<html>
<head>
<!--Import Google Icon Font-->
      <link href="http://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
      <!--Import materialize.css-->
      <link type="text/css" rel="stylesheet" href="/static/css/materialize.min.css"  media="screen,projection"/>

      <!--Let browser know website is optimized for mobile-->
      <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    
<style type="text/css">
	
#paper_frame{
	width: 80%;
	height: 1000px;
	margin-left: 10%;
	margin-right: 10%;
	margin-bottom: 5%;

}


#commentbox{
	margin-bottom: 10%;
}

#comments{

}

</style>
<script type="text/javascript" src="/static/jquery.js"></script>
<script type="text/javascript">

$.ajaxSetup({
	    beforeSend: function(xhr, settings) {
	        if (settings.type == 'POST' || settings.type == 'PUT' || settings.type == 'DELETE') {
	            function getCookie(name) {
	                var cookieValue = null;
	                if (document.cookie && document.cookie != '') {
	                    var cookies = document.cookie.split(';');
	                    for (var i = 0; i < cookies.length; i++) {
	                        var cookie = jQuery.trim(cookies[i]);
	                        // Does this cookie string begin with the name we want?
	                        if (cookie.substring(0, name.length + 1) == (name + '=')) {
	                            cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
	                            break;
	                        }
	                    }
	                }
	                return cookieValue;
	            }
	            if (!(/^http:.*/.test(settings.url) || /^https:.*/.test(settings.url))) {
	                // Only send the token to relative URLs i.e. locally.
	                xhr.setRequestHeader("X-CSRFToken", getCookie('csrftoken'));
	            }
	        }
	    }
	});

	
	$(document).ready(function(){
	$("#submit").click(function(e) {
	var subject = $('#subject').val();
	var content = $('#content').val();
	var paper_id = $('#paper_id').val();
	var comment = {'subject': subject, 'content': content,'paper_id': paper_id};	

	console.log(comment);	
//	var postData = $(this).serializeArray();
  //  var formURL = $(this).attr("action");
    $.ajax(
    {
        url : '/add_comment/',
        type: "POST",
        data : comment,
        success:function(data, textStatus, jqXHR) 
        {
        	data = JSON.parse(data);
        	console.log(data.status);
        	if(data.status == 200)
        		alert("Your comment is added Please refresh the page to see the change");
    		$('#subject').val("");
			$('#content').val("");
	

            //data: return data from server
        },
        error: function(jqXHR, textStatus, errorThrown) 
        {
            //if fails      
        }
    });
    //event.preventDefault(); //STOP default action
    //event.unbind(); //unbind. to stop multiple form submit.
	});

//	$("#commentform").submit();
});

</script>
	<title></title>

		<style type="text/css">

        body {
    padding-top: 50px;
    }
    .papers{
        padding: 40px 15px;
        text-align: center;
    }


	</style>
</head>
<body>

 <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"> </script>
  <script type="text/javascript" src="/static/js/materialize.min.js"> </script>

    <!-- NAV BAR -->
    <nav>
	    <div class="nav-wrapper teal lighten-2">
	      <a href="#" class="brand-logo">Protocol</a>
	      <ul id="nav-mobile" class="right hide-on-med-and-down">
	        <li><a href="/userprofile/">Profile</a></li>
	        <li><a href="/logout/">Log out</a></li>
	        <li><a href="/mypapers/">Papers</a></li>
	      </ul>
	    </div>
    </nav>

<div class="content">
<h3 class="page-header">
	{{paper.title}}
</h3>

<div>
<iframe id='paper_frame' src="/static/web/viewer.html?file={{paper.url}}"></iframe>
</div>

<div>
<h3> <img src="/static/images/view.png" height="50px" width="50px" /> {{paper.views}} Views</h3>	
</div>
<div class="sub-header" id="comments">
	<h2 >Comments</h2>	
<div>
{% if paper.comment_list %} 

{% for item in paper.comment_list %}

 <div class="row">
        <div class="col s12 m6">
          <div class="card teal darken-1">
            <div class="card-content white-text">
              <span class="card-title">{{ item.UserProfile_id }}</span>
              <br>
              <b>{{ item.subject}}</b>
              <p>{{item.content}}</p>
            </div>
            
          </div>
        </div>
      </div>

  {% endfor %}
{% else %}
  There are no new comments
{% endif %}

  
</div>
    
  
</div>

<div  class="sub-header" id='commentbox' class="">
<h2 >Comment Box</h2>

<!-- 	<form id='commentform' name="commentform" method="post" action="/add_comment/"> {% csrf_token %}-->
		<label for="subject" class="col-sm-2 control-label">Subject</label>
    	<div class="col-sm-10">

		<input type="text" id="subject" class="form-control" id="inputSuccess2" name="subject" />
		</div>


		<label for="content" class="col-sm-2 control-label">Content</label>
    	<div class="col-sm-10">

		<textarea rows="4" cols="50" name="content" id="content" class="form-control"> </textarea>
		</div>
		<div> <input type="hidden" id="paper_id" name="paper_id" value="{{paper.paper_id}}"> </div>

		<div class="col-md-8">
		<input id='submit' type="submit" value="submit" class="btn btn-primary btn-lg"/>
		</div>
<!--	</form> -->

</div>
</div>

</body>
</html>
